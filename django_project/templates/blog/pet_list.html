{% extends 'base.html' %}

{% block content %}
  <h2>Список питомцев</h2>
  <form method="get" class="mb-3">
    <div class="row">
      <div class="col-md-3">
        <div class="form-group">
          <label for="species_filter">Фильтр по виду:</label>
          <select name="species" id="species_filter" class="form-control">
            <option value="">Все</option>
            {% for value, label in species_choices %}
              <option value="{{ value }}" {% if species_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="col-md-3">
        <div class="form-group">
          <label for="age_min">Возраст от:</label>
          <input type="number" name="age_min" id="age_min" class="form-control" value="{{ age_min }}">
        </div>
      </div>
      <div class="col-md-3">
        <div class="form-group">
          <label for="age_max">Возраст до:</label>
          <input type="number" name="age_max" id="age_max" class="form-control" value="{{ age_max }}">
        </div>
      </div>
      {% if request.user.is_authenticated and request.user.role == 'admin' %}
        <div class="col-md-3">
          <div class="form-group">
            <label for="owner_filter">Владелец (email):</label>
            <input type="text" name="owner" id="owner_filter" class="form-control" value="{{ owner_filter }}">
          </div>
        </div>
      {% endif %}
      <div class="col-md-3">
        <div class="form-group">
          <label for="created_at_filter">Дата создания:</label>
          <select name="created_at" id="created_at_filter" class="form-control">
            <option value="">Все</option>
            <option value="last_month" {% if created_at_filter == 'last_month' %}selected{% endif %}>За последний месяц</option>
          </select>
        </div>
      </div>
    </div>
    <button type="submit" class="btn btn-primary mt-2">Фильтровать</button>
  </form>
  {% if pets %}
    <ul>
      {% for pet in pets %}
        <li>
          {{ pet.name }} (Вид: {{ pet.get_species_display }}, Возраст: {{ pet.age }})
          - Владелец: {{ pet.owner.email }}
          - Создан: {{ pet.created_at|date:"d.m.Y H:i" }}
          - <a href="{% url 'blog:pet_detail' pet.pk %}">Подробнее</a>
          {% if request.user == pet.owner or request.user.role == 'admin' %}
            <a href="{% url 'blog:pet_update' pet.pk %}" class="ms-2">Редактировать</a>
            <a href="{% url 'blog:pet_delete' pet.pk %}" class="ms-2">Удалить</a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Нет питомцев для отображения.</p>
  {% endif %}
  {% if request.user.is_authenticated %}
    <a href="{% url 'blog:pet_create' %}" class="btn btn-success">Добавить питомца</a>
  {% endif %}
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endblock %}